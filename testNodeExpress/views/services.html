<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>Project X</title>
    <link rel="stylesheet" href=".\stylesheets\main.css" />
    <script src="socket.io/socket.io.js"></script>

    <script>
        function logout() {
            var socket = io.connect();
            socket.emit('logout', { data: 'You clicked the logout button' });
            console.log("logout button clicked");
        };

        function createService() {
            console.log("create button clicked");
            var data = document.getElementsByClassName("selectedrow");
            var socket = io.connect();
            socket.emit('createService', { data: data[0].innerText });
        };

        function highlight(e) {

            var strData = e.target.innerText;
            console.log(strData);

            if (selected[0]) selected[0].className = '';   // clear previous selection

            // enable Create button. It gets disabled only if top title row selected 
            document.getElementById("createButton").removeAttribute("disabled");

            if (strData == "<New Service>") {   // Create button
                document.getElementById("createButton").innerText = "Create";
                createNew = true;
                e.target.parentNode.className = 'selectedrow';
            } else if (strData != "Housing Service") {   // Amend button & ignore title row
                document.getElementById("createButton").innerText = "Amend";
                createNew = false;
                e.target.parentNode.className = 'selectedrow';
            } else {  // title row so disable Create button
                document.getElementById("createButton").setAttribute('disabled', 'disabled');
            }
        };
    </script>

</head>
<body>

    <script>

        var createNew = false;

        window.onload = function () {
            console.log("onload called : " + sessionStorage.getItem("name"));
            var ts = new Date();
            document.getElementById("hLoggedInAs").innerHTML = "Welcome " + sessionStorage.getItem("name"); // + "<br/>" + ts.toString('dddd, MMMM') ;

            // set up table for selection
            var table = document.getElementById("servicetable");
            selected = table.getElementsByClassName("selectedrow");
            table.onclick = highlight;
        };

        var socket = io.connect();

        socket.on('logoutRet', function (data) {
            console.log("logout in browser called ...");
            window.location("/");
        });

        socket.on('createServiceRet', function (data) {
            console.log("Create service in browser called ...");
            sessionStorage.setItem("servicename", data.data);
            if (createNew) {
                window.location("createservice");
            } else {
                window.location("createright");
            }
        });

    </script>

    <div class="flex-title">
        <div>
            <img alt="no logo" src="images/logo.png" width="200" height="200" />
        </div>
        <div>
            <h1>Digital Notary</h1>
            <h3>Services</h3>
        </div>
        <div>
            <h2 id="hLoggedInAs">Welcome </h2>
        </div>
    </div>
    <div>
        <hr />
    </div>
     <div>
         <!-- moves screen down same amount as back arrow on other screens. Invisible cos we don't want to use it to logout -->
         <img alt="no logo" src="images/back_arrow.png" width="30" height="30" style="background-color:rgb(181, 27, 69); visibility:hidden" />
    </div>
    <div class="flex-containercentre">
        <!-- <img alt="no back arrow" src="images/back_arrow.png" width="25" height="25" /> -->
        <div class="flex-containerredtitle">
            <div class="flex-container5">
                <h3>Services</h3>
            </div>
            <div class="flex-container3">
                <div>
                    <div>
                        <div>
                            <h4>Available Services</h4>

                            <div style="overflow-x: auto;">

                                <table id="servicetable" style="width: 600px; background-color: white;">
                                    <tr style="height: 20px">
                                        <td id="tabletitle">Passport Application</td>
                                    </tr>
                                    <tr>
                                        <td>Land Registry</td>
                                    </tr>
                                    <tr>
                                        <td>&lt;New Service&gt;</td>
                                    </tr>
                                </table>
                            </div>
                            <br />

                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div>&nbsp;</div>
        <div class="flex-containerbuttons">
            <div>
                &nbsp;
                <button id="createButton" type="button" onclick="createService()" disabled="disabled">Create</button>
            </div>
            <br />
            <br />
            <br />
            <div>
                &nbsp;
            <button id="logoutButton" type="button" onclick="logout()">Logout</button>
            </div>
        </div>
    </div>

</body>
</html>
